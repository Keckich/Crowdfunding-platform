@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager
@model Сrowdfunding.Models.ViewModels.CommentViewModel
@{
}
<article>
    <section class="row justify-content-between">
        <div class="col-12 col-md-6">
            <img class="unit-img" height="250" src="@Url.Content(Model.Campaign.ImageUrl)" />
        </div>
        <div class="col-12 col-md-6">
            <div id="detail-title" class="row justify-content-between">
                <h2>@Model.Campaign.Name</h2>
                <div id="rate-form">
                    @await Html.PartialAsync("_RatingPartial", Model.Rating)
                </div>
            </div>

                
            <p>@Model.Campaign.ShortDescription</p>
            <div>
                @Model.Campaign.Author
            </div>
            <div>
                <b>Goal: @Model.Campaign.TotalSum$</b>
            </div>
            <div>
                <b>Remain @Model.Campaign.RemainSum$</b>
            </div>

            <div>
                <form method="get" asp-controller="Home" asp-action="Support" asp-route-id="@Model.Campaign.Id">
                    <button>Support</button>
                </form>
                @if (UserManager.GetUserAsync(User).Result != null && UserManager.GetUserAsync(User).Result.UserName == Model.Campaign.Author)
                {
                    <form method="get" asp-controller="Home" asp-action="Rewards" asp-route-id="@Model.Campaign.Id">
                        <button>Add rewards</button>
                    </form>
                }
            </div>
            @if (Model.Campaign.Ended)
            {
                <div>
                    <b>Campaign was ended!</b>
                </div>
            }                
        </div>

    </section>
    <section id="story-section">
        <h2>Story</h2>
        @Html.Raw(Model.Campaign.Story)
    </section>
    <nav>
        <hr />
        <form method="get">
        </form>
        <hr />
    </nav>
    <section id="commentSection">
        <h2>Comments</h2>
        <form method="post" asp-action="Details" asp-controller="Home"
              data-ajax="true" data-ajax-mode="replace" data-ajax-update="#commentSection" enctype="multipart/form-data">
            <input type="hidden" name="CampaignId" value="@Model.Campaign.Id" />
            <textarea class="form-control" name="Content"></textarea>
            <input type="submit" value="Submit" />
        </form>
        <div id="comments"></div>
        @*@await Html.PartialAsync("~/Views/Home/CommentList.cshtml", Model)*@
    </section>
</article>